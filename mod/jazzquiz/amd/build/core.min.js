function _classCallCheck(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function _createClass(a,b,c){if(b)_defineProperties(a.prototype,b);if(c)_defineProperties(a,c);return a}define ("mod_jazzquiz/core",["jquery","core/config","core/str","core/yui","core/event"],function($,mConfig,mString,Y,mEvent){var session={courseModuleId:0,activityId:0,sessionId:0,attemptId:0,sessionKey:""},cache=[],Ajax=function(){function a(){_classCallCheck(this,a)}_createClass(a,null,[{key:"request",value:function request(a,b,c,d){c.id=session.courseModuleId;c.sessionid=session.sessionId;c.attemptid=session.attemptId;c.sesskey=session.sessionKey;return $.ajax({type:a,url:b,data:c,dataType:"json",success:d,error:function error(){}}).fail(function(){return setText(Quiz.info,"error_with_request")})}},{key:"get",value:function get(b,c,d){c.action=b;return a.request("get","ajax.php",c,d)}},{key:"post",value:function post(b,c,d){c.action=b;return a.request("post","ajax.php",c,d)}}]);return a}(),Question=function(){function Question(a){_classCallCheck(this,Question);this.quiz=a;this.isRunning=!1;this.isSaving=!1;this.endTime=0;this.isVoteRunning=!1;this.hasVotes=!1;this.countdownTimeLeft=0;this.questionTime=0;this.countdownInterval=0;this.timerInterval=0}_createClass(Question,[{key:"refresh",value:function refresh(){var _this=this;Ajax.get("get_question_form",{},function(data){if(data.is_already_submitted){setText(Quiz.info,"wait_for_instructor");return}Quiz.show(Question.box.html(data.html));eval(data.js);data.css.forEach(function(a){var b=document.getElementsByTagName("head")[0],c=document.createElement("link");c.rel="stylesheet";c.type="text/css";c.href=a;b.appendChild(c)});_this.quiz.role.onQuestionRefreshed(data);Quiz.renderAllMathjax()})}},{key:"hideTimer",value:function hideTimer(){Quiz.hide(Question.timer);clearInterval(this.timerInterval);this.timerInterval=0}},{key:"onCountdownTick",value:function onCountdownTick(a){this.countdownTimeLeft--;if(0>=this.countdownTimeLeft){clearInterval(this.countdownInterval);this.countdownInterval=0;this.startAttempt(a)}else if(0!==this.countdownTimeLeft){setText(Quiz.info,"question_will_start_in_x_seconds","jazzquiz",this.countdownTimeLeft)}else{setText(Quiz.info,"question_will_start_now")}}},{key:"startCountdown",value:function startCountdown(a,b){var c=this;if(0!==this.countdownInterval){return!0}a=parseInt(a);b=parseInt(b);this.countdownTimeLeft=b;if(1>b){if(0<a&&b<-a){return!1}if(1<a){this.startAttempt(a+b)}else{this.startAttempt(0)}return!0}this.countdownInterval=setInterval(function(){return c.onCountdownTick(a)},1e3);return!0}},{key:"onTimerEnding",value:function onTimerEnding(){this.isRunning=!1;this.quiz.role.onTimerEnding()}},{key:"onTimerTick",value:function onTimerTick(){var a=new Date().getTime();if(a>this.endTime){this.hideTimer();this.onTimerEnding()}else{var b=parseInt((this.endTime-a)/1e3);this.quiz.role.onTimerTick(b)}}},{key:"startAttempt",value:function startAttempt(a){var b=this;Quiz.hide(Quiz.info);this.refresh();this.isRunning=!0;a=parseInt(a);if(0===a){return}this.quiz.role.onTimerTick(a);this.endTime=new Date().getTime()+1e3*a;this.timerInterval=setInterval(function(){return b.onTimerTick()},1e3)}}],[{key:"box",get:function get(){return $("#jazzquiz_question_box")}},{key:"timer",get:function get(){return $("#jazzquiz_question_timer")}},{key:"form",get:function get(){return $("#jazzquiz_question_form")}},{key:"isLoaded",value:function isLoaded(){return""!==Question.box.html()}}]);return Question}(),Quiz=function(){function a(b){_classCallCheck(this,a);this.state="";this.isNewState=!1;this.question=new Question(this);this.role=new b(this);this.events={notrunning:"onNotRunning",preparing:"onPreparing",running:"onRunning",reviewing:"onReviewing",sessionclosed:"onSessionClosed",voting:"onVoting"}}_createClass(a,[{key:"changeQuizState",value:function changeQuizState(a,b){this.isNewState=this.state!==a;this.state=a;this.role.onStateChange(a);var c=this.events[a];this.role[c](b)}},{key:"poll",value:function poll(a){var b=this;Ajax.get("info",{},function(c){b.changeQuizState(c.status,c);setTimeout(function(){return b.poll(a)},a)})}}],[{key:"main",get:function get(){return $("#jazzquiz")}},{key:"info",get:function get(){return $("#jazzquiz_info_container")}},{key:"responded",get:function get(){return $("#jazzquiz_responded_container")}},{key:"responses",get:function get(){return $("#jazzquiz_responses_container")}},{key:"responseInfo",get:function get(){return $("#jazzquiz_response_info_container")}},{key:"hide",value:function hide(a){a.addClass("hidden")}},{key:"show",value:function show(a){a.removeClass("hidden")}},{key:"uncheck",value:function uncheck(a){a.children(".fa").removeClass("fa-check-square-o").addClass("fa-square-o")}},{key:"check",value:function check(a){a.children(".fa").removeClass("fa-square-o").addClass("fa-check-square-o")}},{key:"renderAllMathjax",value:function renderAllMathjax(){mEvent.notifyFilterContentUpdated(document.getElementsByClassName("jazzquiz-response-container"))}},{key:"addMathjaxElement",value:function addMathjaxElement(b,c){b.html("<span class=\"filter_mathjaxloader_equation\">"+c+"</span>");a.renderAllMathjax()}},{key:"renderMaximaEquation",value:function renderMaximaEquation(b,c){var d=document.getElementById(c);if(null===d){return}if(cache[b]!==void 0){a.addMathjaxElement($("#"+c),cache[b]);return}Ajax.get("stack",{input:encodeURIComponent(b)},function(b){cache[b.original]=b.latex;a.addMathjaxElement($("#"+c),b.latex)})}}]);return a}();function setText(a,b,c,d){c=c!==void 0?c:"jazzquiz";d=d!==void 0?d:[];$.when(mString.get_string(b,c,d)).done(function(b){return Quiz.show(a.html(b))})}return{initialize:function initialize(a,b,c,d,e){session.courseModuleId=a;session.activityId=b;session.sessionId=c;session.attemptId=d;session.sessionKey=e},Quiz:Quiz,Question:Question,Ajax:Ajax,setText:setText}});
//# sourceMappingURL=core.min.js.map
