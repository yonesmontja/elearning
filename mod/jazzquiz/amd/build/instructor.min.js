function _classCallCheck(a,b){if(!(a instanceof b)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(a,b){for(var c=0,d;c<b.length;c++){d=b[c];d.enumerable=d.enumerable||!1;d.configurable=!0;if("value"in d)d.writable=!0;Object.defineProperty(a,d.key,d)}}function _createClass(a,b,c){if(b)_defineProperties(a.prototype,b);if(c)_defineProperties(a,c);return a}define ("mod_jazzquiz/instructor",["jquery","mod_jazzquiz/core"],function(a,b){var c=b.Quiz,d=b.Question,e=b.Ajax,f=b.setText,g=function(){function b(c){var d=this;_classCallCheck(this,b);this.quiz=c;this.currentResponses=[];this.showVotesUponReview=!1;this.respondedCount=0;this.showResponses=!1;this.totalStudents=0;a(document).on("click","#jazzquiz_undo_merge",function(){return d.undoMerge()});a(document).on("click",function(a){if(a.target.classList.contains("bar")){d.startMerge(a.target.id)}else if(a.target.parentNode&&a.target.parentNode.classList.contains("bar")){d.startMerge(a.target.parentNode.id)}});a(document).on("click","#review_show_normal_results",function(){return d.refresh(!1)});a(document).on("click","#review_show_vote_results",function(){return d.refreshVotes()})}_createClass(b,[{key:"clear",value:function clear(){c.responses.html("");c.responseInfo.html("")}},{key:"hide",value:function hide(){c.uncheck(h.control("responses"));c.hide(c.responses);c.hide(c.responseInfo)}},{key:"show",value:function show(){c.check(h.control("responses"));c.show(c.responses);c.show(c.responseInfo);if(this.showVotesUponReview){this.refreshVotes();this.showVotesUponReview=!1}else{this.refresh(!1)}}},{key:"toggle",value:function toggle(){this.showResponses=!this.showResponses;if(this.showResponses){this.show()}else{this.hide()}}},{key:"endMerge",value:function endMerge(){a(".merge-into").removeClass("merge-into");a(".merge-from").removeClass("merge-from")}},{key:"undoMerge",value:function undoMerge(){var a=this;e.post("undo_merge",{},function(){return a.refresh(!0)})}},{key:"merge",value:function merge(a,b){var c=this;e.post("merge_responses",{from:a,into:b},function(){return c.refresh(!1)})}},{key:"startMerge",value:function startMerge(b){var c=a("#"+b),d=c.parent();if(d.hasClass("merge-from")){this.endMerge();return}if(d.hasClass("merge-into")){var f=a(".merge-from");this.merge(f.data("response"),d.data("response"));this.endMerge();return}d.addClass("merge-from");var e=d.parent().parent();e.find("tr").each(function(){var b=a(this).find("td");if(b[1].id!==c.attr("id")){a(this).addClass("merge-into")}})}},{key:"createControls",value:function createControls(b){if(!this.quiz.question.hasVotes){c.hide(c.responseInfo);return}if("reviewing"===this.quiz.state){var d=a("#review_show_normal_results"),e=a("#review_show_vote_results");c.show(c.responseInfo);if("vote_response"===b){if(0===d.length){f(c.responseInfo.html("<h4 class=\"inline\"></h4>").children("h4"),"showing_vote_results");c.responseInfo.append("<button id=\"review_show_normal_results\" class=\"btn btn-primary\"></button><br>");f(a("#review_show_normal_results"),"click_to_show_original_results");e.remove()}}else if("current_response"===b){if(0===e.length){f(c.responseInfo.html("<h4 class=\"inline\"></h4>").children("h4"),"showing_original_results");c.responseInfo.append("<button id=\"review_show_vote_results\" class=\"btn btn-primary\"></button><br>");f(a("#review_show_vote_results"),"click_to_show_vote_results");d.remove()}}}}},{key:"createBarGraph",value:function createBarGraph(b,d,e,f,g){var h=document.getElementById(e);if(null===h){return}for(var k=0,l=0,m=0,n;m<b.length;m++){n=parseInt(b[m].count);k+=n;if(n>l){l=n}}if(0===k){k=1}if(g){h.innerHTML=""}for(var u=0,v;u<h.rows.length;u++){v=!0;for(var w=0;w<b.length;w++){if(h.rows[u].dataset.response===b[w].response){v=!1;break}}if(v){h.deleteRow(u);u--}}this.createControls(d);d+=f;for(var j=0;j<b.length;j++){for(var o=100*(parseInt(b[j].count)/l),p=-1,q=-1,r=0;r<h.rows.length;r++){if(h.rows[r].dataset.response===b[j].response){p=h.rows[r].dataset.row_i;q=r;break}}if(-1===p){p=h.rows.length;var x=h.insertRow();x.dataset.response_i=j;x.dataset.response=b[j].response;x.dataset.percent=o;x.dataset.row_i=p;x.dataset.count=b[j].count;x.classList.add("selected-vote-option");if(15>o){x.classList.add("outside")}var s="<span id=\""+d+"_count_"+p+"\">"+b[j].count+"</span>",t=x.insertCell(0);t.onclick=function(){a(this).parent().toggleClass("selected-vote-option")};var y=x.insertCell(1);y.classList.add("bar");y.id=d+"_bar_"+p;y.innerHTML="<div style=\"width:"+o+"%;\">"+s+"</div>";var z=d+"_latex_"+p;t.innerHTML="<span id=\""+z+"\"></span>";c.addMathjaxElement(a("#"+z),b[j].response);if("stack"===b[j].qtype){c.renderMaximaEquation(b[j].response,z)}}else{var A=h.rows[q];A.dataset.row_i=p;A.dataset.response_i=j;A.dataset.percent=o;A.dataset.count=b[j].count;var B=A.classList.contains("outside");if(15<o&&B){A.classList.remove("outside")}else if(15>o&&!B){A.classList.add("outside")}var C=document.getElementById(d+"_count_"+p);if(null!==C){C.innerHTML=b[j].count}var D=document.getElementById(d+"_bar_"+p);if(null!==D){D.firstElementChild.style.width=o+"%"}}}}},{key:"set",value:function set(d,e,g,h,k,l,m){if(g===void 0){return}if(0===g.length){c.show(c.responded);f(c.responded.find("h4"),"a_out_of_b_responded","jazzquiz",{a:0,b:this.totalStudents});return}switch(k){case"shortanswer":for(var p=0;p<g.length;p++){g[p].response=g[p].response.trim()}break;case"stack":for(var i=0;i<g.length;i++){g[i].response=g[i].response.replace(/\s/g,"")}break;default:break;}this.currentResponses=[];this.respondedCount=0;for(var q=0;q<g.length;q++){var n=!1,o=1;if(g[q].count!==void 0){o=parseInt(g[q].count)}this.respondedCount+=o;for(var r=0;r<this.currentResponses.length;r++){if(this.currentResponses[r].response===g[q].response){this.currentResponses[r].count+=o;n=!0;break}}if(!n){this.currentResponses.push({response:g[q].response,count:o,qtype:k})}}if(0!==c.responded.length&&h!==void 0){c.show(c.responded);f(c.responded.find("h4"),"a_out_of_b_responded","jazzquiz",{a:h,b:this.totalStudents})}if(!this.showResponses&&"reviewing"!==this.quiz.state){c.hide(c.responseInfo);c.hide(c.responses);return}if(null===document.getElementById(e)){c.show(a("#"+d).html("<table id=\""+e+"\" class=\"jazzquiz-responses-overview\"></table>"))}this.createBarGraph(this.currentResponses,"current_response",e,l,m);b.sortBarGraph(e)}},{key:"refresh",value:function refresh(b){var d=this;e.get("get_results",{},function(e){d.quiz.question.hasVotes=e.has_votes;d.totalStudents=parseInt(e.total_students);d.set("jazzquiz_responses_container","current_responses_wrapper",e.responses,e.responded,e.question_type,"results",b);if(0<e.merge_count){c.show(a("#jazzquiz_undo_merge"))}else{c.hide(a("#jazzquiz_undo_merge"))}})}},{key:"refreshVotes",value:function refreshVotes(){var a=this;if(!this.showResponses&&"reviewing"!==this.quiz.state){c.hide(c.responseInfo);c.hide(c.responses);return}e.get("get_vote_results",{},function(d){var e=d.answers,g="wrapper_vote_responses",h=[];a.respondedCount=0;a.totalStudents=parseInt(d.total_students);for(var j in e){if(!e.hasOwnProperty(j)){continue}h.push({response:e[j].attempt,count:e[j].finalcount,qtype:e[j].qtype,slot:e[j].slot});a.respondedCount+=parseInt(e[j].finalcount)}f(c.responded.find("h4"),"a_out_of_b_voted","jazzquiz",{a:a.respondedCount,b:a.totalStudents});if(null===document.getElementById(g)){c.show(c.responses.html("<table id=\""+g+"\" class=\"jazzquiz-responses-overview\"></table>"))}a.createBarGraph(h,"vote_response",g,"vote",!1);b.sortBarGraph(g)})}}],[{key:"sortBarGraph",value:function sortBarGraph(a){var b=document.getElementById(a);if(null===b){return}var c=!0;while(c){c=!1;for(var f=0;f<b.rows.length-1;f++){var d=parseInt(b.rows[f].dataset.percent),e=parseInt(b.rows[f+1].dataset.percent);if(d<e){b.rows[f].parentNode.insertBefore(b.rows[f+1],b.rows[f]);c=!0;break}}}}}]);return b}(),h=function(){function b(c){var d=this;_classCallCheck(this,b);this.quiz=c;this.responses=new g(c);this.isShowingCorrectAnswer=!1;this.totalQuestions=0;this.allowVote=!1;a(document).on("keyup",function(a){if(27===a.keyCode){b.closeFullscreenView()}});a(document).on("click",function(a){b.closeQuestionListMenu(a,"improvise");b.closeQuestionListMenu(a,"jump")});b.addEvents({repoll:function repoll(){return d.repollQuestion()},vote:function vote(){return d.runVoting()},improvise:function improvise(){return d.showQuestionListSetup("improvise")},jump:function jump(){return d.showQuestionListSetup("jump")},next:function next(){return d.nextQuestion()},random:function random(){return d.randomQuestion()},end:function end(){return d.endQuestion()},fullscreen:function fullscreen(){return b.showFullscreenView()},answer:function answer(){return d.showCorrectAnswer()},responses:function responses(){return d.responses.toggle()},exit:function exit(){return d.closeSession()},quit:function quit(){return d.closeSession()},startquiz:function startquiz(){return d.startQuiz()}});b.addHotkeys({t:"responses",r:"repoll",a:"answer",e:"end",j:"jump",i:"improvise",v:"vote",n:"next",m:"random",f:"fullscreen"})}_createClass(b,[{key:"onNotRunning",value:function onNotRunning(a){this.responses.totalStudents=a.student_count;c.hide(b.side);f(c.info,"instructions_for_instructor");b.enableControls([]);c.hide(b.controlButtons);var d=b.control("startquiz").next();if(1===a.student_count){f(d,"one_student_has_joined")}else if(1<a.student_count){f(d,"x_students_have_joined","jazzquiz",a.student_count)}else{f(d,"no_students_have_joined")}c.show(b.control("startquiz").parent())}},{key:"onPreparing",value:function onPreparing(a){c.hide(b.side);f(c.info,"instructions_for_instructor");var d=["improvise","jump","random","fullscreen","quit"];if(a.slot<this.totalQuestions){d.push("next")}b.enableControls(d)}},{key:"onRunning",value:function onRunning(a){if(!this.responses.showResponses){this.responses.hide()}c.show(b.side);b.enableControls(["end","responses","fullscreen"]);this.quiz.question.questionTime=a.questiontime;if(this.quiz.question.isRunning){if(0<a.questionTime&&a.delay<-a.questiontime){this.endQuestion()}this.responses.refresh(!b.isMerging)}else{var d=this.quiz.question.startCountdown(a.questiontime,a.delay);if(d){this.quiz.question.isRunning=!0}}}},{key:"onReviewing",value:function onReviewing(a){c.show(b.side);var e=["answer","repoll","fullscreen","improvise","jump","random","quit"];if(this.allowVote){e.push("vote")}if(a.slot<this.totalQuestions){e.push("next")}b.enableControls(e);if(!d.isLoaded()){this.quiz.question.refresh()}if(this.quiz.isNewState){this.responses.show()}this.quiz.question.isRunning=!1}},{key:"onSessionClosed",value:function onSessionClosed(){c.hide(b.side);c.hide(b.correctAnswer);b.enableControls([]);this.responses.clear();this.quiz.question.isRunning=!1}},{key:"onVoting",value:function onVoting(){if(!this.responses.showResponses){this.responses.hide()}c.show(b.side);b.enableControls(["quit","fullscreen","answer","responses","end"]);this.responses.refreshVotes()}},{key:"onStateChange",value:function onStateChange(){a("#region-main").find("ul.nav.nav-tabs").css("display","none");a("#region-main-settings-menu").css("display","none");a(".region_main_settings_menu_proxy").css("display","none");c.show(b.controlButtons);c.hide(b.control("startquiz").parent())}},{key:"onQuestionRefreshed",value:function onQuestionRefreshed(a){this.allowVote=a.voteable}},{key:"onTimerEnding",value:function onTimerEnding(){this.endQuestion()}},{key:"onTimerTick",value:function onTimerTick(a){f(d.timer,"x_seconds_left","jazzquiz",a)}},{key:"startQuiz",value:function startQuiz(){c.hide(b.control("startquiz").parent());e.post("start_quiz",{},function(){return a("#jazzquiz_controls").removeClass("btn-hide")})}},{key:"endQuestion",value:function endQuestion(){var a=this;this.quiz.question.hideTimer();e.post("end_question",{},function(){if("voting"===a.quiz.state){a.responses.showVotesUponReview=!0}else{a.quiz.question.isRunning=!1;b.enableControls([])}})}},{key:"showQuestionListSetup",value:function showQuestionListSetup(d){var f=this,g=b.control(d);if(g.hasClass("active")){return}e.get("list_"+d+"_questions",{},function(b){var e=a("#jazzquiz_"+d+"_menu"),h=g.offset().left-g.parent().offset().left;e.html("").addClass("active").css("margin-left",h+"px");g.addClass("active");var j=b.questions;for(var k in j){if(!j.hasOwnProperty(k)){continue}var i=a("<button class=\"btn\"></button>");c.addMathjaxElement(i,j[k].name);i.data({time:j[k].time,"question-id":j[k].questionid,"jazzquiz-question-id":j[k].jazzquizquestionid});i.data("test",1);i.on("click",function(){var b=a(this).data("question-id"),c=a(this).data("time"),d=a(this).data("jazzquiz-question-id");f.jumpQuestion(b,c,d);e.html("").removeClass("active");g.removeClass("active")});e.append(i)}})}},{key:"runVoting",value:function runVoting(){var a=b.getSelectedAnswersForVote(),c={questions:encodeURIComponent(JSON.stringify(a))};e.post("run_voting",c,function(){})}},{key:"startQuestion",value:function startQuestion(a,b,d,f){var g=this;c.hide(c.info);this.responses.clear();this.hideCorrectAnswer();e.post("start_question",{method:a,questionid:b,questiontime:d,jazzquizquestionid:f},function(a){return g.quiz.question.startCountdown(a.questiontime,a.delay)})}},{key:"jumpQuestion",value:function jumpQuestion(a,b,c){this.startQuestion("jump",a,b,c)}},{key:"repollQuestion",value:function repollQuestion(){this.startQuestion("repoll",0,0,0)}},{key:"nextQuestion",value:function nextQuestion(){this.startQuestion("next",0,0,0)}},{key:"randomQuestion",value:function randomQuestion(){this.startQuestion("random",0,0,0)}},{key:"closeSession",value:function closeSession(){c.hide(a("#jazzquiz_undo_merge"));c.hide(d.box);c.hide(b.controls);f(c.info,"closing_session");e.post("close_session",{},function(){return window.location=location.href.split("&")[0]})}},{key:"hideCorrectAnswer",value:function hideCorrectAnswer(){if(this.isShowingCorrectAnswer){c.hide(b.correctAnswer);c.uncheck(b.control("answer"));this.isShowingCorrectAnswer=!1}}},{key:"showCorrectAnswer",value:function showCorrectAnswer(){var a=this;this.hideCorrectAnswer();e.get("get_right_response",{},function(d){c.show(b.correctAnswer.html(d.right_answer));c.renderAllMathjax();c.check(b.control("answer"));a.isShowingCorrectAnswer=!0})}}],[{key:"addHotkeys",value:function addHotkeys(c){var d=function(d){if(c.hasOwnProperty(d)){c[d]={action:c[d],repeat:!1};a(document).on("keydown",function(e){if(c[d].repeat||e.ctrlKey){return}if(String.fromCharCode(e.which).toLowerCase()!==d){return}var f=a(":focus").prop("tagName");if(f!==void 0){f=f.toLowerCase();if("input"===f||"textarea"===f){return}}e.preventDefault();c[d].repeat=!0;var g=b.control(c[d].action);if(g.length&&!g.prop("disabled")){g.click()}});a(document).on("keyup",function(a){if(String.fromCharCode(a.which).toLowerCase()===d){c[d].repeat=!1}})}};for(var e in c){d(e)}}},{key:"addEvents",value:function addEvents(c){var d=function(d){if(c.hasOwnProperty(d)){a(document).on("click","#jazzquiz_control_"+d,function(){b.enableControls([]);c[d]()})}};for(var e in c){d(e)}}},{key:"controls",get:function get(){return a("#jazzquiz_controls_box")}},{key:"controlButtons",get:function get(){return b.controls.find(".quiz-control-buttons")}},{key:"control",value:function control(b){return a("#jazzquiz_control_"+b)}},{key:"side",get:function get(){return a("#jazzquiz_side_container")}},{key:"correctAnswer",get:function get(){return a("#jazzquiz_correct_answer_container")}},{key:"isMerging",get:function get(){return 0!==a(".merge-from").length}},{key:"getSelectedAnswersForVote",value:function getSelectedAnswersForVote(){var b=[];a(".selected-vote-option").each(function(a,c){b.push({text:c.dataset.response,count:c.dataset.count})});return b}},{key:"enableControls",value:function enableControls(a){b.controlButtons.children("button").each(function(b,c){var d=c.getAttribute("id").replace("jazzquiz_control_","");c.disabled=-1===a.indexOf(d)})}},{key:"showFullscreenView",value:function showFullscreenView(){if(c.main.hasClass("jazzquiz-fullscreen")){b.closeFullscreenView();return}document.documentElement.style.overflowY="hidden";c.main.addClass("jazzquiz-fullscreen")}},{key:"closeFullscreenView",value:function closeFullscreenView(){document.documentElement.style.overflowY="auto";c.main.removeClass("jazzquiz-fullscreen")}},{key:"closeQuestionListMenu",value:function closeQuestionListMenu(c,d){var e="#jazzquiz_"+d+"_menu",f=a(c.target).closest(e);if(!f.length){a(e).html("").removeClass("active");b.control(d).removeClass("active")}}},{key:"addReportEventHandlers",value:function addReportEventHandlers(){a(document).on("click","#report_overview_controls button",function(){var b=a(this).data("action");if("attendance"===b){a("#report_overview_responded").fadeIn();a("#report_overview_responses").fadeOut()}else if("responses"===b){a("#report_overview_responses").fadeIn();a("#report_overview_responded").fadeOut()}})}}]);return b}();return{initialize:function initialize(a,b,d){var e=new c(h);e.role.totalQuestions=a;if(b){h.addReportEventHandlers();e.role.responses.showResponses=!0;d.forEach(function(a){var b="jazzquiz_wrapper_responses_"+a.num,c="responses_wrapper_table_"+a.num,d="report_"+a.num;e.role.responses.set(b,c,a.responses,void 0,a.type,d,!1)})}else{e.poll(500)}}}});
//# sourceMappingURL=instructor.min.js.map
