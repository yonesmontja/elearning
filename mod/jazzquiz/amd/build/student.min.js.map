{"version":3,"sources":["../src/student.js"],"names":["define","$","Jazz","Quiz","Question","Ajax","setText","Student","quiz","voteAnswer","self","document","on","event","preventDefault","submitAnswer","saveVote","value","info","data","question","isRunning","started","startCountdown","questiontime","delay","isVoteRunning","hideTimer","hide","box","window","location","href","split","html","show","options","i","length","addMathjaxElement","content_id","text","question_type","renderMaximaEquation","timeLeft","timer","isSaving","tinyMCE","triggerSave","serialized","form","serializeArray","name","hasOwnProperty","post","feedback","fail","vote","status","initialize","poll"],"mappings":"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","sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * @package   mod_jazzquiz\n * @author    Sebastian S. Gundersen <sebastsg@stud.ntnu.no>\n * @copyright 2014 University of Wisconsin - Madison\n * @copyright 2018 NTNU\n * @license   http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'mod_jazzquiz/core'], function ($, Jazz) {\n\n    const Quiz = Jazz.Quiz;\n    const Question = Jazz.Question;\n    const Ajax = Jazz.Ajax;\n    const setText = Jazz.setText;\n\n    class Student {\n\n        /**\n         * @param {Quiz} quiz\n         */\n        constructor(quiz) {\n            this.quiz = quiz;\n            this.voteAnswer = undefined;\n            let self = this;\n            $(document).on('submit', '#jazzquiz_question_form', function(event) {\n                event.preventDefault();\n                self.submitAnswer();\n            }).on('click', '#jazzquiz_save_vote', function() {\n                self.saveVote();\n            }).on('click', '.jazzquiz-select-vote', function() {\n                self.voteAnswer = this.value;\n            });\n        }\n\n        onNotRunning(data) {\n            setText(Quiz.info, 'instructions_for_student');\n        }\n\n        onPreparing(data) {\n            setText(Quiz.info, 'wait_for_instructor');\n        }\n\n        onRunning(data) {\n            if (this.quiz.question.isRunning) {\n                return;\n            }\n            const started = this.quiz.question.startCountdown(data.questiontime, data.delay);\n            if (!started) {\n                setText(Quiz.info, 'wait_for_instructor');\n            }\n        }\n\n        onReviewing(data) {\n            this.quiz.question.isVoteRunning = false;\n            this.quiz.question.isRunning = false;\n            this.quiz.question.hideTimer();\n            Quiz.hide(Question.box);\n            setText(Quiz.info, 'wait_for_instructor');\n        }\n\n        onSessionClosed(data) {\n            window.location = location.href.split('&')[0];\n        }\n\n        onVoting(data) {\n            if (this.quiz.question.isVoteRunning) {\n                return;\n            }\n            Quiz.info.html(data.html);\n            Quiz.show(Quiz.info);\n            const options = data.options;\n            for (let i = 0; i < options.length; i++) {\n                Quiz.addMathjaxElement($('#' + options[i].content_id), options[i].text);\n                if (options[i].question_type === 'stack') {\n                    Quiz.renderMaximaEquation(options[i].text, options[i].content_id);\n                }\n            }\n            this.quiz.question.isVoteRunning = true;\n        }\n\n        onStateChange(state) {\n\n        }\n\n        onQuestionTimerEnding() {\n\n        }\n\n        onTimerTick(timeLeft) {\n            setText(Question.timer, 'question_will_end_in_x_seconds', 'jazzquiz', timeLeft);\n        }\n\n        onQuestionRefreshed(data) {\n\n        }\n\n        /**\n         * Submit answer for the current question.\n         */\n        submitAnswer() {\n            if (this.quiz.question.isSaving) {\n                // Don't save twice.\n                return;\n            }\n            this.quiz.question.isSaving = true;\n            if (typeof tinyMCE !== 'undefined') {\n                tinyMCE.triggerSave();\n            }\n            const serialized = Question.form.serializeArray();\n            let data = {};\n            for (let name in serialized) {\n                if (serialized.hasOwnProperty(name)) {\n                    data[serialized[name].name] = serialized[name].value;\n                }\n            }\n            Ajax.post('save_question', data, data => {\n                if (data.feedback.length > 0) {\n                    Quiz.show(Quiz.info.html(data.feedback));\n                } else {\n                    setText(Quiz.info, 'wait_for_instructor');\n                }\n                this.quiz.question.isSaving = false;\n                if (!this.quiz.question.isRunning) {\n                    return;\n                }\n                if (this.quiz.question.isVoteRunning) {\n                    return;\n                }\n                Quiz.hide(Question.box);\n                this.quiz.question.hideTimer();\n            }).fail(() => {\n                this.quiz.question.isSaving = false;\n            });\n        }\n\n        saveVote() {\n            Ajax.post('save_vote', {vote: this.voteAnswer}, data => {\n                if (data.status === 'success') {\n                    setText(Quiz.info, 'wait_for_instructor');\n                } else {\n                    setText(Quiz.info, 'you_already_voted');\n                }\n            });\n        }\n\n    }\n\n    return {\n        initialize: () => {\n            let quiz = new Quiz(Student);\n            quiz.poll(2000);\n        }\n    }\n\n});\n"],"file":"student.min.js"}