define ("mod_quizgame/quizgame",["jquery","core/yui","core/notification","core/ajax"],function(a,b,c,d){var aa,ba,ca,da=0,ea=[],fa=[],ga=["pix/icon.gif","pix/planet.png","pix/ship.png","pix/enemy.png","pix/enemystem.png","pix/enemychoice.png","pix/enemystemselected.png","pix/enemychoiceselected.png","pix/laser.png","pix/enemylaser.png"],ha=0,ia=!1,ja,ka,la=-1,ma={x:0,y:0,width:0,height:0},na="",oa,pa,qa=!1,ra=!1,sa=[],ta=0,ua=0,va,wa=!1;a("#mod_quizgame_fullscreen_button").on("click",function(){if(wa){wa=!1;f()}else{h()}});function e(a){if(document.getElementById("mod_quizgame_sound_on").checked){var b=document.getElementById("mod_quizgame_sound_"+a);b.currentTime=0;b.play()}}function f(){wa=!1;ca.removeAttribute("width");ca.removeAttribute("height");ca.removeAttribute("style");ca.classList.remove("floating-game-canvas");a("#button_container").removeClass("floating-button-container fixed-bottom");ma.width=ca.clientWidth;ma.height=ca.clientHeight;ca.style.width=ma.width;ca.style.height=ma.height;i(ca)}function g(){if(wa){f()}}function h(){var b=window.matchMedia("(orientation: landscape)").matches;if(ca.requestFullscreen){ca.requestFullscreen()}else if(ca.msRequestFullscreen){ca.msRequestFullscreen()}else if(ca.mozRequestFullScreen){ca.mozRequestFullScreen()}wa=!0;var c=a("#button_container"),d=window.innerWidth,e=a(window).height();if(b&&d<e){e=d}e-=c.height()+16;ma.width=d;ma.height=e;ca.style.width=d+"px";ca.style.height=e+"px";ca.classList.add("floating-game-canvas");c.addClass("floating-button-container fixed-bottom");a("#mod_quizgame_fullscreen_button").blur();i(ca)}function i(a){a.width=ma.width;a.height=ma.height;va.imageSmoothingEnabled=!1}function j(){if(wa){h()}else{f()}}function k(){document.onkeydown=null;document.onkeyup=null;document.onmousedown=null;document.onmouseup=null;document.onmousemove=null;document.ontouchstart=null;document.ontouchend=null;document.ontouchmove=null;window.onresize=null}function l(){k();document.onkeydown=O;document.onmouseup=P;document.ontouchend=Q;window.onresize=j}function m(){va.clearRect(0,0,ma.width,ma.height);va.fillStyle="#FFFFFF";va.font="18px Audiowide";va.textAlign="center";if(null!==aa&&0<aa.length){va.fillText(M.util.get_string("spacetostart","mod_quizgame"),ma.width/2,ma.height/2);l()}else{va.fillText(M.util.get_string("emptyquiz","mod_quizgame"),ma.width/2,ma.height/2)}}function n(){$(aa);if(!ia){ga.forEach(function(a){var b=new Image;b.src=a;b.onload=function(){ha++;if(ha>=ga.length){p()}}});ia=!0}else{q()}}function o(){d.call([{methodname:"mod_quizgame_update_score",args:{quizgameid:ba,score:Math.trunc(da)},fail:c.exception}]);l()}function p(){clearInterval(oa);oa=setInterval(function(){t(va,ma,fa,ea,na);u(ma,fa,ea)},40);q()}function q(){da=0;fa=[];ea=[];la=-1;pa=.5;qa=!1;ra=!1;d.call([{methodname:"mod_quizgame_start_game",args:{quizgameid:ba},fail:c.exception}]);ja=new x("pix/ship.png",0,0);ja.x=ma.width/2;ja.y=ma.height/2;fa.push(ja);ka=new y("pix/planet.png",0,0);ka.image.width=ma.width;ka.image.height=ma.height;ka.direction.y=1;ka.movespeed.y=.7;ea.push(ka);r();document.onkeyup=S;document.onkeydown=R;document.onmouseup=U;document.onmousedown=T;document.onmousemove=V;document.ontouchstart=X;document.ontouchend=Y;document.ontouchmove=Z;window.onresize=j;document.addEventListener("gesturestart",W,!1);document.addEventListener("gesturechange",W,!1);document.addEventListener("gestureend",W,!1)}function r(){la++;if(la>=aa.length){la=0;pa*=1.3}na=s(aa,la,ma)}function s(a,b,c){sa=[];ta=0;ua=0;if("truefalse"==a[b].type){a[b].answers.forEach(function(a){var b=new B(Math.random()*c.width,-Math.random()*c.height/2,a.text,a.fraction);sa.push(b);fa.push(b)});ua=0}else if("multichoice"==a[b].type){a[b].answers.forEach(function(d){var e=new C(Math.random()*c.width,-Math.random()*c.height/2,d.text,d.fraction,a[b].single);if(1>d.fraction){sa.push(e);if(0<d.fraction){ua+=parseFloat(d.fraction)}}fa.push(e)})}else if("match"==a[b].type){var d=0,e=1/(2*a[b].stems.length);ua+=1;a[b].stems.forEach(function(a){d++;var b=new D(Math.random()*c.width,-Math.random()*c.height/2,a.question,e,-d,!0),f=new D(Math.random()*c.width,-Math.random()*c.height/2,a.answer,e,d);sa.push(b);sa.push(f);fa.push(b);fa.push(f)})}return a[b].question}function t(a,b,c,d,e){a.clearRect(0,0,b.width,b.height);var f=0;for(f=0;f<d.length;f++){d[f].draw(a)}for(f=0;f<c.length;f++){c[f].draw(a)}if(ja.alive){a.fillStyle="#FFFFFF";a.font="18px Audiowide";a.textAlign="left";a.fillText(M.util.get_string("score","mod_quizgame",{score:Math.round(da),lives:ja.lives}),5,b.height-20);a.textAlign="center";L(a,e,!1,20,.9*b.width,b.width/2,20)}else{a.fillStyle="#FFFFFF";a.font="18px Audiowide";a.textAlign="center";a.fillText(M.util.get_string("endofgame","mod_quizgame",Math.round(ja.lastScore)),b.width/2,b.height/2)}}function u(a,b,c){var d=0;for(d=0;3>d;d++){c.push(new G(a))}for(d=0;d<c.length;d++){c[d].update(a);if(!c[d].alive){c.splice(d,1);d--}}for(d=0;d<b.length;d++){b[d].update(a);for(var e=d+1;e<b.length;e++){H(b[d],b[e])}if(!b[d].alive){b.splice(d,1);d--}}}function v(a,b,c,d){this.left=a||0;this.top=b||0;this.width=c||0;this.height=d||0}v.prototype.right=function(){return this.left+this.width};v.prototype.bottom=function(){return this.top+this.height};v.prototype.Contains=function(a){return a.x>this.left&&a.x<this.right()&&a.y>this.top&&a.y<this.bottom()};v.prototype.Intersect=function(a){var b=!(a.left>this.right()||a.right()<this.left||a.top>this.bottom()||a.bottom()<this.top);return b};function w(a,b,c){if(null!==a){this.image=this.loadImage(a)}this.x=b;this.y=c;this.velocity={x:0,y:0};this.direction={x:0,y:0};this.movespeed={x:5,y:3};this.alive=!0;this.decay=.7}w.prototype.loadImage=function(a){if(!this.image){this.image=new Image}this.image.src=a;return this.image};w.prototype.update=function(){this.velocity.x+=this.direction.x*this.movespeed.x;this.velocity.y+=this.direction.y*this.movespeed.y;this.x+=this.velocity.x;this.y+=this.velocity.y;this.velocity.y*=this.decay;this.velocity.x*=this.decay};w.prototype.draw=function(a){a.drawImage(this.image,this.x,this.y,this.image.width,this.image.height)};w.prototype.getRect=function(){return new v(this.x,this.y,this.image.width,this.image.height)};w.prototype.die=function(){this.alive=!1};function x(a,b,c){w.call(this,a,b,c);this.mouse={x:0,y:0};this.movespeed={x:6,y:4};this.lives=3;this.lastScore=0}x.prototype=Object.create(w.prototype);x.prototype.update=function(a){if(ra||qa){if(this.x<this.mouse.x-this.image.width){ja.direction.x=1}else if(this.x>this.mouse.x){ja.direction.x=-1}else{ja.direction.x=0}if(this.y<this.mouse.y-this.image.height){ja.direction.y=1}else if(this.y>this.mouse.y){ja.direction.y=-1}else{ja.direction.y=0}}w.prototype.update.call(this,a);if(this.x<a.x-this.image.width){this.x=a.width}else if(this.x>a.width){this.x=a.x-this.image.width}if(this.y<a.y){this.y=a.y}else if(this.y>a.height-this.image.height){this.y=a.height-this.image.height}};x.prototype.Shoot=function(){e("laser");fa.unshift(new E(ja.x,ja.y,!0,24));xa=!1};x.prototype.die=function(){w.prototype.die.call(this);e("explosion");K(this.x+this.image.width/2,this.y+this.image.height/2,200,"#FFCC00");this.lastScore=da;o()};x.prototype.gotShot=function(a){if(a.alive){if(1>=this.lives){this.die()}else{this.lives--;K(this.x+this.image.width/2,this.y+this.image.height/2,100,"#FFCC00")}}};function y(a,b,c){w.call(this,a,b,c)}y.prototype=Object.create(w.prototype);y.prototype.update=function(a){ka.image.width=ma.width;ka.image.height=ma.height;w.prototype.update.call(this,a)};function z(a,b,c,d,e){w.call(this,a,b,c);this.xspeed=pa;this.yspeed=pa*(2+Math.random())/4;this.movespeed.x=0;this.movespeed.y=0;this.direction.y=1;this.text=d;this.fraction=e;this.movementClock=0;this.shotFrequency=80;this.shotClock=(1+Math.random())*this.shotFrequency;this.level=la}z.prototype=Object.create(w.prototype);z.prototype.update=function(a){if(this.y<a.height/10||this.y>9*a.height/10){this.movespeed.x=1*this.xspeed;this.movespeed.y=5*this.yspeed}else{this.movespeed.x=this.xspeed;this.movespeed.y=this.yspeed}w.prototype.update.call(this,a);this.movementClock--;if(0>=this.movementClock){this.direction.x=Math.floor(3*Math.random())-1;this.movementClock=30*(2+Math.random())}this.shotClock-=pa;if(0>=this.shotClock){if(this.y<.6*a.height){e("enemylaser");var b=new E(this.x,this.y);b.direction.y=1;b.friendly=!1;fa.unshift(b);this.shotClock=(1+Math.random())*this.shotFrequency}}if(this.x<a.x-this.image.width){this.x=a.width}else if(this.x>a.width){this.x=a.x-this.image.width}if(this.y>a.height+this.image.height&&this.alive){this.alive=!1;if(0<this.fraction){ua-=this.fraction;da-=1e3*this.fraction}N.call(this)}};z.prototype.draw=function(a){w.prototype.draw.call(this,a);a.fillStyle="#FFFFFF";a.font="15px Audiowide";a.textAlign="center";L(a,this.text,!0,17,.2*ma.width,this.x+this.image.width/2,this.y-5)};z.prototype.die=function(){w.prototype.die.call(this);K(this.x+this.image.width,this.y+this.image.height,50+150*this.fraction,"#FF0000");da+=1e3*this.fraction;e("explosion")};z.prototype.gotShot=function(a){a.die();this.die()};function A(){sa.forEach(function(a){if(a.alive){a.fraction=0;a.die()}});sa=[]}function B(a,b,c,d){z.call(this,"pix/enemy.png",a,b,c,d)}B.prototype=Object.create(z.prototype);B.prototype.die=function(){z.prototype.die.call(this);A();if(0<this.fraction){r()}};B.prototype.gotShot=function(a){if(0<this.fraction){a.die();this.die()}else{da+=600*(this.fraction-.5);a.deflect()}};function C(a,b,c,d,e){z.call(this,"pix/enemy.png",a,b,c,d);this.single=e}C.prototype=Object.create(z.prototype);C.prototype.die=function(){z.prototype.die.call(this);if(0<this.fraction){ua-=this.fraction}if(this.single&&1===this.fraction&&1<=this.fraction||0<this.fraction&&0>=ua){A();r()}};C.prototype.gotShot=function(a){if(1<=this.fraction||0<this.fraction&&!this.single){a.die();this.die()}else{da+=600*(this.fraction-.5);a.deflect()}};function D(a,b,c,d,e,f){this.stem=f?!0:!1;if(this.stem){z.call(this,"pix/enemystem.png",a,b,c,d)}else{z.call(this,"pix/enemychoice.png",a,b,c,d)}this.pairid=e;this.shotFrequency=160;this.hightlighted=!1}D.prototype=Object.create(z.prototype);D.prototype.die=function(){ua-=this.fraction;this.fraction=0;z.prototype.die.call(this)};D.prototype.gotShot=function(a){if(a.alive&&this.alive){if(ta==-this.pairid){da+=2*(1e3*this.fraction);a.die();this.die();var b=0;sa.forEach(function(a){if(a.pairid==ta){a.die()}if(a.alive){b++}});if(0>=b){r()}}else{if(ta==this.pairid){a.deflect()}else{a.die();this.hightlight();ta=this.pairid}}}};D.prototype.hightlight=function(){sa.forEach(function(a){a.unhightlight()});if(this.stem){this.loadImage("pix/enemystemselected.png")}else{this.loadImage("pix/enemychoiceselected.png")}this.hightlighted=!0};D.prototype.unhightlight=function(){if(this.hightlighted){if(this.stem){this.loadImage("pix/enemystem.png")}else{this.loadImage("pix/enemychoice.png")}}this.hightlighted=!1};function E(a,b,c,d){w.call(this,c?"pix/laser.png":"pix/enemylaser.png",a,b);this.direction.y=-1;this.friendly=c?1:0;this.laserSpeed=d||12}E.prototype=Object.create(w.prototype);E.prototype.update=function(a){w.prototype.update.call(this,a);if(this.x<a.x-this.image.width||this.x>a.width||this.y<a.y-this.image.height||this.y>a.height){this.alive=!1}this.velocity.y=this.laserSpeed*this.direction.y};E.prototype.deflect=function(){this.image=this.loadImage("pix/enemylaser.png");this.direction.y*=-1;this.friendly=!this.friendly;e("deflect")};function F(a,b,c,d){w.call(this,null,a,b);this.width=2;this.height=2;this.velocity.x=c.x;this.velocity.y=c.y;this.aliveTime=0;this.colour=d;this.decay=1}F.prototype=Object.create(w.prototype);F.prototype.update=function(a){w.prototype.update.call(this,a);if(this.x<a.x-this.width||this.x>a.width||this.y<a.y-this.height||this.y>a.height){this.alive=!1}this.aliveTime++;if(this.aliveTime>15*Math.random()+5){this.alive=!1}};F.prototype.getRect=function(){return new v(this.x,this.y,this.width,this.height)};F.prototype.draw=function(a){a.fillStyle=this.colour;a.fillRect(this.x,this.y,this.width,this.height);a.stroke()};function G(a){w.call(this,null,Math.random()*a.width,0);this.width=2;this.height=2;this.direction.y=1;this.movespeed.y=.2+Math.random()/2;this.aliveTime=0}G.prototype=Object.create(w.prototype);G.prototype.update=function(a){w.prototype.update.call(this,a);if(this.y>a.height){this.alive=!1}};G.prototype.draw=function(a){a.fillStyle="#9999AA";a.fillRect(this.x,this.y,this.width,this.height);a.stroke()};function H(a,b){return a.alive&&b.alive&&(I(a,b)||I(b,a))}function I(a,b){if(a instanceof E&&b instanceof x){if(!a.friendly&&J(a,b)){b.gotShot(a);a.die();return!0}}if(a instanceof E&&b instanceof z){if(a.friendly&&J(a,b)){b.gotShot(a);return!0}}if(a instanceof x&&b instanceof z){if(J(a,b)){a.die();return!0}}return!1}function J(a,b){var c=a.getRect(),d=b.getRect();return c.Intersect(d)}function K(a,b,c,d){for(var e=0;e<c;e++){ea.push(new F(a,b,{x:16*(Math.random()-.5),y:16*(Math.random()-.5)+3},d))}}function L(a,b,c,d,e,f,g){var h=[],i=g,j=b.split(" "),k="";j.forEach(function(b){var c=k+" "+b,f=a.measureText(c),i=f.width;if(i>e){h.push({text:k,y:g+=d});k=b}else{k=c}});h.push({text:k,y:g+=d});var l=g-i;h.forEach(function(b){var d=c?-l:0;a.fillText(b.text,f,b.y+d)})}function N(){var a=sa.filter(function(a){return a.alive}).length;if(0===a&&(ua<this.fraction||0>=ua)&&this.level===la&&ja.alive){r()}}var xa=!0;function O(a){if(-1!==[32,37,38,39,40].indexOf(a.keyCode)){a.preventDefault();if(32===a.keyCode){n()}}}function P(a){if(a.target===ca){n()}}function Q(a){if(a.target===ca){n()}}function R(a){if(-1!==[32,37,38,39,40].indexOf(a.keyCode)){a.preventDefault();if(32===a.keyCode&&ja.alive&&xa){ja.Shoot()}else if(37===a.keyCode){ja.direction.x=-1}else if(38===a.keyCode){ja.direction.y=-1}else if(39===a.keyCode){ja.direction.x=1}else if(40===a.keyCode){ja.direction.y=1}}}function S(a){if(32===a.keyCode){xa=!0}else if(-1!==[37,39].indexOf(a.keyCode)){ja.direction.x=0}else if(-1!==[38,40].indexOf(a.keyCode)){ja.direction.y=0}}function T(a){if(a.target===ca){var b=ja.getRect().Contains({x:a.offsetX,y:a.offsetY});if(b&&ja.alive){ja.Shoot()}if(!ra){ja.mouse.x=a.offsetX;ja.mouse.y=a.offsetY;ra=!0}}}function U(){ja.direction.x=0;ja.direction.y=0;ra=!1}function V(a){ja.mouse.x=a.offsetX;ja.mouse.y=a.offsetY}function W(a){if(a.target===ca){a.preventDefault()}}function X(a){if(a.target===ca){if(ja.alive&&1<a.touches.length){ja.Shoot()}else{qa=!0;Z(a)}a.preventDefault()}}function Y(a){if(0===a.touches.length){qa=!1}ja.direction.x=0;ja.direction.y=0;if(a.target===ca){a.preventDefault()}}function Z(a){var b=a.target.getBoundingClientRect(),c=a.touches[0].pageX-b.left,d=a.touches[0].clientY-b.top;window.stage=ca;ja.mouse.x=c;ja.mouse.y=d;if(a.target===ca){a.preventDefault()}}function $(a){var b=a.length,c,d;while(0!==b){d=Math.floor(Math.random()*b);b-=1;c=a[b];a[b]=a[d];a[d]=c}return a}function _(a,b){aa=a;ba=b;if(document.addEventListener){document.addEventListener("fullscreenchange",g,!1);document.addEventListener("MSFullscreenChange",g,!1);document.addEventListener("mozfullscreenchange",g,!1);document.addEventListener("webkitfullscreenchange",g,!1)}ca=document.getElementById("mod_quizgame_game");va=ca.getContext("2d");f();oa=setInterval(function(){m()},500)}return{init:_}});
//# sourceMappingURL=quizgame.min.js.map
